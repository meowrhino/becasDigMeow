<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>meowrhino studio — backup</title>
  <style>
@import url("https://fonts.googleapis.com/css2?family=Inknut+Antiqua:wght@300;400;500;600;700&display=swap");

/* ============================================
   RESET & BASE
   ============================================ */

html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  box-sizing: border-box;
  font-family: "Inknut Antiqua", serif;
  font-weight: 400;
  line-height: 1.3;
  background: #ffffff;
  color: #000000;
}

*, *::before, *::after {
  box-sizing: border-box;
}

a {
  color: inherit;
  text-decoration: none;
}

p, h1, h2, h3 {
  margin: 0;
  padding: 0;
}

/* ============================================
   CONTAINER
   ============================================ */

#content {
  position: relative;
  width: 100dvw;
  height: 100dvh;
}

/* ============================================
   CELDAS (PAGES)
   ============================================ */

.celda {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  left: 0;
  margin: 0;
  padding: 10dvh 10dvw;
  box-sizing: border-box;
  background-color: #ffffff;
  color: #000000;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.6s ease-in-out;
  display: flex;
  align-items: center;
  justify-content: center;
}

.celda.activa {
  opacity: 1;
  pointer-events: auto;
}

/* ============================================
   ZONE LABEL (large background text)
   ============================================ */

.zone-label-bg {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-family: "Inknut Antiqua", serif;
  font-size: clamp(5rem, 18dvw, 16rem);
  font-weight: 300;
  color: rgba(0, 0, 0, 0.03);
  text-transform: lowercase;
  letter-spacing: -0.03em;
  pointer-events: none;
  z-index: 1;
  white-space: nowrap;
  user-select: none;
  transition: opacity 0.6s ease;
  line-height: 1;
}

/* ============================================
   TOP-RIGHT HEADER (minimap inline)
   ============================================ */

.header-topright {
  position: fixed;
  top: 3dvh;
  right: 3dvw;
  z-index: 100;
}

.minimap-inline {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  grid-template-rows: repeat(2, 1fr);
  gap: 3px;
  cursor: pointer;
  opacity: 0.7;
  transition: opacity 0.2s ease;
}

.minimap-inline:hover {
  opacity: 1;
}

.minimap-inline-cell {
  background: #d0d0d0;
  transition: background 0.2s ease;
}

.minimap-inline-cell.activa {
  background: #000;
}

.minimap-inline-cell.invisible {
  visibility: hidden;
}

/* ============================================
   EXPANDED MINIMAP (overlay)
   ============================================ */

.minimap-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100dvw;
  height: 100dvh;
  background: rgba(255, 255, 255, 0.97);
  z-index: 200;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}

.minimap-overlay.visible {
  opacity: 1;
  pointer-events: auto;
}

.minimap-expanded {
  display: grid;
  gap: 12px;
}

.minimap-expanded-cell {
  background: #c0c0c0;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  border: none;
  padding: 0;
  font-family: "Inknut Antiqua", serif;
  font-size: clamp(0.5rem, 1dvw, 0.85rem);
  color: #ffffff;
  transition: background 0.3s ease, transform 0.3s ease;
  text-transform: lowercase;
}

.minimap-expanded-cell:hover {
  transform: scale(1.06);
  background: #555;
}

.minimap-expanded-cell.activa {
  background: #000000;
}

.minimap-expanded-cell.invisible {
  visibility: hidden;
}

/* ============================================
   NAVIGATION LABELS (side text)
   ============================================ */

.nav-label {
  position: absolute;
  font-size: clamp(0.7rem, 1dvw, 1rem);
  color: #999;
  cursor: pointer;
  z-index: 10;
  transition: color 0.3s ease;
  font-family: "Inknut Antiqua", serif;
  letter-spacing: 0.05em;
  border: none;
  background: none;
  padding: 0;
}

.nav-label:hover {
  color: #000;
}

.nav-label.left {
  left: 3dvw;
  top: 50%;
  writing-mode: vertical-rl;
  transform: translateY(-50%) rotate(180deg);
}

.nav-label.right {
  right: 3dvw;
  top: 50%;
  writing-mode: vertical-rl;
  transform: translateY(-50%);
}

.nav-label.top {
  top: 3dvh;
  left: 50%;
  transform: translateX(-50%) rotate(180deg);
}

.nav-label.bottom {
  bottom: 3dvh;
  left: 50%;
  transform: translateX(-50%);
}

/* ============================================
   PAGE: WELCOME
   ============================================ */

.celda.welcome {
  align-items: center;
  justify-content: center;
  overflow-y: auto;
  padding: 0 10dvw;
}

.welcome-content {
  width: 100%;
  min-height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.welcome-title {
  position: fixed;
  top: 12dvh;
  left: 50%;
  transform: translateX(-50%);
  font-size: clamp(1.6rem, 3.5dvw, 3rem);
  font-weight: 400;
  letter-spacing: 0.05em;
  text-align: center;
  white-space: nowrap;
  pointer-events: none;
  z-index: 2;
}

.welcome-tools {
  width: 70vw;
  width: 70dvw;
  max-width: 800px;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

/* Link button — tarjeta como en el linktree */
.tool-link {
  display: block;
  width: 100%;
  text-align: center;
  background: rgba(255, 255, 255, 0.8);
  border: 1px solid rgba(0,0,0,0.12);
  border-radius: 4px;
  padding: 0.4rem 1rem;
  font-family: "Inknut Antiqua", serif;
  font-size: clamp(0.7rem, 0.95dvw, 0.9rem);
  font-weight: 600;
  color: #000;
  text-decoration: none;
  transition: border-color 0.2s ease, background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);
  position: relative;
}

.tool-link:hover {
  border-color: rgba(0,0,0,0.35);
  background: rgba(255, 255, 255, 0.8);
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.08);
}

.tool-link:active {
  transform: translateY(0);
}

/* Dropdown — mismo tamaño exacto que tool-link */
.tools-dropdown-group {
  display: flex;
  flex-direction: column;
  gap: 0;
  width: 100%;
}

.tools-dropdown-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  width: 100%;
  appearance: none;
  -webkit-appearance: none;
  background: rgba(255, 255, 255, 0.8);
  border: 1px solid rgba(0,0,0,0.12);
  border-radius: 4px;
  padding: 0.4rem 1rem;
  font-family: "Inknut Antiqua", serif;
  font-size: clamp(0.7rem, 0.95dvw, 0.9rem);
  font-weight: 600;
  color: #000;
  cursor: pointer;
  transition: border-color 0.2s ease, background 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
  box-shadow: 0 1px 2px rgba(0,0,0,0.05);
  text-align: center;
}

.tools-dropdown-btn:hover {
  border-color: rgba(0,0,0,0.35);
  background: rgba(255, 255, 255, 0.8);
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.08);
}

.tools-dropdown-btn.active {
  border-color: rgba(0,0,0,0.35);
  background: rgba(255, 255, 255, 0.8);
}

.tools-dropdown-icon {
  width: 12px;
  height: 12px;
  transition: transform 0.3s ease;
  flex-shrink: 0;
  opacity: 0.5;
}

.tools-dropdown-btn.active .tools-dropdown-icon {
  transform: rotate(180deg);
}

/* Contenido desplegable */
.tools-dropdown-content {
  display: grid;
  grid-template-rows: 0fr;
  transition: grid-template-rows 0.3s ease;
  overflow: hidden;
  width: 100%;
  background: rgba(255, 255, 255, 0.8);
}

.tools-dropdown-content.open {
  grid-template-rows: 1fr;
}

.tools-dropdown-inner {
  min-height: 0;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  margin-top: 0;
  transition: margin-top 0.2s ease;
}

.tools-dropdown-content.open .tools-dropdown-inner {
  margin-top: 0.5rem;
}

/* ============================================
   PAGE: PORTFOLIO — screenshots flotando
   ============================================ */

.celda.portfolio {
  padding: 0;
  overflow: hidden;
  background: #ffffff;
}

.portfolio-clouds-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  overflow: hidden;
}

/* Cada item es la screenshot flotando directamente */
.portfolio-cloud-item {
  position: absolute;
  cursor: pointer;
  text-decoration: none;
  color: inherit;
  display: block;
  animation-iteration-count: infinite;
  animation-direction: normal;
  animation-timing-function: linear;
}

.portfolio-cloud-item img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: opacity 0.3s ease;
}

.portfolio-cloud-item:hover img {
  opacity: 0.88;
}

.portfolio-cloud-item .pcloud-name {
  position: absolute;
  bottom: -1.4em;
  left: 50%;
  transform: translateX(-50%);
  font-size: clamp(0.5rem, 0.7dvw, 0.65rem);
  font-weight: 400;
  text-align: center;
  white-space: nowrap;
  opacity: 0;
  transition: opacity 0.2s;
  pointer-events: none;
  color: #999;
  letter-spacing: 0.04em;
}

.portfolio-cloud-item:hover .pcloud-name {
  opacity: 1;
}

/* Portfolio: grid mode */
.portfolio-grid-container {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 10dvh 10dvw;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.5s ease;
}

.portfolio-grid-container.visible {
  opacity: 1;
  pointer-events: auto;
}

.portfolio-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: clamp(8px, 1.2dvw, 16px);
  width: 100%;
  max-width: 1100px;
}

.portfolio-item {
  aspect-ratio: 4/3;
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.3s ease;
  display: block;
  border-radius: 4px;
}

.portfolio-item:hover {
  transform: translateY(-3px);
}

.portfolio-item img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  display: block;
}

/* Switch button */
.portfolio-switch {
  position: absolute;
  bottom: 3dvh;
  right: 3dvw;
  z-index: 10;
  font-family: "Inknut Antiqua", serif;
  font-size: clamp(0.6rem, 0.85dvw, 0.8rem);
  color: #999;
  background: #fff;
  border: 1px solid #ccc;
  padding: 0.4em 0.8em;
  cursor: pointer;
  transition: color 0.2s, border-color 0.2s;
  letter-spacing: 0.05em;
  border-radius: 4px;
}

.portfolio-switch:hover {
  color: #000;
  border-color: #000;
}

/* Float animations — cielo nublado, movimiento horizontal de izquierda a derecha
   con deriva vertical leve y rotación mínima, como nubes reales */
@keyframes pcloud1 {
  from { transform: translateX(0px)   translateY(0px)   rotate(-0.3deg); }
  to   { transform: translateX(120px) translateY(-8px)  rotate( 0.4deg); }
}
@keyframes pcloud2 {
  from { transform: translateX(0px)   translateY(0px)   rotate( 0.5deg); }
  to   { transform: translateX(90px)  translateY( 6px)  rotate(-0.3deg); }
}
@keyframes pcloud3 {
  from { transform: translateX(0px)   translateY(0px)   rotate(-0.2deg); }
  to   { transform: translateX(150px) translateY(-4px)  rotate( 0.6deg); }
}
@keyframes pcloud4 {
  from { transform: translateX(0px)   translateY(0px)   rotate( 0.4deg); }
  to   { transform: translateX(70px)  translateY( 10px) rotate(-0.5deg); }
}
@keyframes pcloud5 {
  from { transform: translateX(0px)   translateY(0px)   rotate(-0.6deg); }
  to   { transform: translateX(110px) translateY( 4px)  rotate( 0.2deg); }
}
@keyframes pcloud6 {
  from { transform: translateX(0px)   translateY(0px)   rotate( 0.3deg); }
  to   { transform: translateX(80px)  translateY(-12px) rotate(-0.4deg); }
}

@media (max-width: 1024px) {
  .portfolio-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (max-width: 600px) {
  .portfolio-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

/* ============================================
   PAGE: STATEMENT
   ============================================ */

.statement-content {
  text-align: center;
  max-width: 800px;
  line-height: 1.6;
  font-size: clamp(0.85rem, 1.2dvw, 1.15rem);
}

.statement-content p {
  margin-bottom: 0.5em;
}

/* ============================================
   PAGE: METODOLOGIA (zigzag)
   ============================================ */

.metodologia-content {
  width: 100%;
  max-width: 1000px;
}

.metodo-zigzag {
  display: grid;
  grid-template-columns: repeat(10, 1fr);
  grid-template-rows: auto auto auto;
  gap: 0;
  align-items: start;
}

.metodo-paso {
  text-align: center;
  overflow: visible;
}

.metodo-paso .metodo-semana {
  display: none;
}

.metodo-paso h3 {
  font-size: clamp(0.75rem, 1dvw, 1rem);
  font-weight: 700;
  margin-bottom: 0.5em;
}

.metodo-paso p {
  font-size: clamp(0.6rem, 0.8dvw, 0.82rem);
  color: #444;
  line-height: 1.6;
}

.metodo-timeline-bar {
  grid-column: 1 / -1;
  grid-row: 3;
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  padding-top: 3dvh;
  margin-top: 2dvh;
}

.metodo-timeline-bar span {
  font-size: clamp(0.6rem, 0.75dvw, 0.78rem);
  font-weight: 700;
  text-align: center;
}

@media (max-width: 768px) {
  .celda.metodologia {
    padding: 12dvh 8dvw;
  }

  .metodo-zigzag {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 2.5dvh;
  }

  .metodo-paso {
    text-align: center;
    padding-left: 2em;
    position: relative;
    width: 75%;
    max-width: 320px;
  }

  .metodo-paso .metodo-semana {
    display: block;
    font-size: clamp(0.55rem, 2dvw, 0.7rem);
    font-weight: 700;
    white-space: nowrap;
    position: absolute;
    left: 0;
    top: 0;
    transform: rotate(90deg);
    transform-origin: top left;
  }

  .metodo-timeline-bar {
    display: none;
  }
}

/* ============================================
   PAGE: PRICING
   ============================================ */

.pricing-content {
  text-align: center;
  max-width: 680px;
  line-height: 1.6;
}

.pricing-content .precio-rango {
  font-size: clamp(1.4rem, 2.5dvw, 2.4rem);
  font-weight: 300;
  letter-spacing: 0.04em;
  margin-bottom: 0.4em;
}

.pricing-content .precio-nota {
  font-size: clamp(0.65rem, 0.85dvw, 0.8rem);
  color: #999;
  margin-bottom: 2.5em;
  line-height: 1.8;
}

.pricing-content .incluye-lista {
  list-style: none;
  padding: 0;
  margin: 0;
}

.pricing-content .incluye-item {
  font-size: clamp(0.75rem, 1dvw, 0.95rem);
  margin-bottom: 0.5em;
  color: #333;
}

.pricing-content .incluye-item::before {
  content: "·";
  margin-right: 0.6em;
  color: #999;
}

/* ============================================
   PAGE: POLITICAS
   ============================================ */

.politicas-content {
  text-align: center;
  max-width: 720px;
  line-height: 1.9;
  font-size: clamp(0.8rem, 1.05dvw, 1rem);
}

.politicas-content p {
  margin-bottom: 2em;
  color: #333;
}

.politicas-content p:last-child {
  margin-bottom: 0;
  color: #888;
  font-size: 0.88em;
}

/* ============================================
   RESPONSIVE
   ============================================ */

@media (max-width: 768px) {
  .nav-label {
    font-size: clamp(0.6rem, 2.5dvw, 0.8rem);
  }
}
  </style>
</head>
<body>
  <div id="content"></div>
  <script>
// ============================================
// meowrhino studio — fusión
// Grid navegable + portfolio-screenshots flotando
// ============================================

const app = document.getElementById("content");

// ============================================
// GRID CONFIGURATION
// Row 0: [pricing] [politicas] [metodologia] [welcome] [statement]
// Row 1:                                     [portfolio]
// ============================================

const grid = [
  [1, 1, 1, 1, 1],
  [0, 0, 0, 1, 0],
];

const nombresEspeciales = {
  "0_0": "pricing",
  "0_1": "politicas",
  "0_2": "metodologia",
  "0_3": "welcome",
  "0_4": "statement",
  "1_3": "portfolio",
};

let posY = 0;
let posX = 3;
let dataCache = null;
const DEFAULT_LANG = "es";
let portfolioMode = "clouds";
let portfolioAnimating = false;

// ============================================
// DATA LOADING
// ============================================

async function loadData() {
  if (dataCache) return dataCache;
  try {
    const res = await fetch("data.json");
    dataCache = await res.json();
    return dataCache;
  } catch (err) {
    console.error("Error loading data.json:", err);
    return null;
  }
}

function getData() {
  if (!dataCache) return null;
  return dataCache[DEFAULT_LANG] || dataCache["es"] || null;
}

// ============================================
// CREATE PAGES
// ============================================

function crearPantallas() {
  for (let y = 0; y < grid.length; y++) {
    for (let x = 0; x < grid[y].length; x++) {
      if (grid[y][x] === 1) {
        const celda = document.createElement("div");
        celda.classList.add("celda", `pos_${y}_${x}`);
        celda.dataset.y = y;
        celda.dataset.x = x;
        const nombre = nombresEspeciales[`${y}_${x}`];
        if (nombre) {
          celda.classList.add(nombre);
          celda.dataset.nombre = nombre;
        }
        app.appendChild(celda);
      }
    }
  }
}

// ============================================
// RENDER: WELCOME
// Un bloque con 3 desplegables
// ============================================

function renderWelcome(data) {
  const el = document.querySelector(".celda.welcome");
  if (!el || !data) return;

  // Desplegables
  const dropdowns = [
    {
      name: "herramientas web",
      items: [
        { name: "imgToWeb",   url: "https://meowrhino.github.io/imgToWeb/" },
        { name: "videoToWeb", url: "https://meowrhino.github.io/videoToWeb/" },
        { name: "colorfun",   url: "https://meowrhino.github.io/colorFun/" },
      ]
    },
    {
      name: "autónomos",
      items: [
        { name: "calculadora impuestos", url: "https://meowrhino.github.io/calculadoraInversa/" },
        { name: "generador facturas",    url: "https://meowrhino.github.io/generadorFacturas/" },
      ]
    },
    {
      name: "formateadores",
      items: [
        { name: "paula",   url: "https://meowrhino.github.io/paulabarjau/formateador.html" },
        { name: "miranda", url: "https://meowrhino.github.io/mirandaperezhita/formateador.html" },
        { name: "andrea",  url: "https://meowrhino.github.io/andreacarilla/formateador.html" },
        { name: "jaume",   url: "https://meowrhino.github.io/jaumeclotet/formateador.html" },
      ]
    },
  ];

  const dropdownsHTML = dropdowns.map((dd, i) => {
    const uid = `dd_${i}`;
    const ddItems = dd.items.map(item => {
      return `<a class="tool-link" href="${item.url}" target="_blank" rel="noopener">${item.name}</a>`;
    }).join("");
    return `
      <div class="tools-dropdown-group">
        <button class="tools-dropdown-btn" data-target="${uid}">
          ${dd.name}
          <svg class="tools-dropdown-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="4,6 8,10 12,6"/></svg>
        </button>
        <div class="tools-dropdown-content" id="${uid}">
          <div class="tools-dropdown-inner">${ddItems}</div>
        </div>
      </div>
    `;
  }).join("");

  el.innerHTML = `
    <div class="welcome-content">
      <h1 class="welcome-title">${data.welcome.titulo}</h1>
      <div class="welcome-tools">${dropdownsHTML}</div>
    </div>
  `;

  el.querySelectorAll(".tools-dropdown-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const target = document.getElementById(btn.dataset.target);
      if (!target) return;
      const willOpen = !target.classList.contains("open");

      el.querySelectorAll(".tools-dropdown-content.open").forEach(opened => {
        opened.classList.remove("open");
      });
      el.querySelectorAll(".tools-dropdown-btn.active").forEach(activeBtn => {
        activeBtn.classList.remove("active");
      });

      target.classList.toggle("open", willOpen);
      btn.classList.toggle("active", willOpen);
    });
  });
}

// ============================================
// RENDER: STATEMENT
// ============================================

function renderStatement(data) {
  const el = document.querySelector(".celda.statement");
  if (!el || !data?.statement) return;
  const lineas = data.statement.lineas.map(l => `<p>${l}</p>`).join("");
  el.innerHTML = `<div class="statement-content">${lineas}</div>`;
}

// ============================================
// RENDER: METODOLOGIA
// ============================================

function renderMetodologia(data) {
  const el = document.querySelector(".celda.metodologia");
  if (!el || !data?.metodologia) return;

  const placements = [
    "grid-row:1; grid-column:1 / span 2;",
    "grid-row:2; grid-column:2 / span 4;",
    "grid-row:1; grid-column:5 / span 2;",
    "grid-row:2; grid-column:6 / span 4;",
    "grid-row:1; grid-column:9 / span 2;",
  ];

  const pasosHTML = data.metodologia.pasos.map((paso, i) => `
    <div class="metodo-paso" style="${placements[i]}">
      <span class="metodo-semana">${paso.semana}</span>
      <div class="metodo-texto">
        <h3>${paso.titulo}</h3>
        <p>${paso.descripcion.replace(/\n/g, "<br>")}</p>
      </div>
    </div>
  `).join("");

  const timelineHTML = data.metodologia.pasos.map(p => `<span>${p.semana}</span>`).join("");

  el.innerHTML = `
    <div class="metodologia-content">
      <div class="metodo-zigzag">
        ${pasosHTML}
        <div class="metodo-timeline-bar">${timelineHTML}</div>
      </div>
    </div>
  `;
}

// ============================================
// RENDER: PRICING
// ============================================

function renderPricing(data) {
  const el = document.querySelector(".celda.pricing");
  if (!el || !data?.pricing) return;
  const d = data.pricing;
  const incluyeHTML = d.incluye.map(i => `<li class="incluye-item">${i}</li>`).join("");
  el.innerHTML = `
    <div class="pricing-content">
      <p class="precio-rango">${d.rango}</p>
      <p class="precio-nota">${d.nota.replace(/\n/g, "<br>")}</p>
      <ul class="incluye-lista">${incluyeHTML}</ul>
    </div>
  `;
}

// ============================================
// RENDER: POLITICAS
// ============================================

function renderPoliticas(data) {
  const el = document.querySelector(".celda.politicas");
  if (!el || !data?.politicas) return;
  const html = data.politicas.parrafos.map(p => `<p>${p.replace(/\n/g, "<br>")}</p>`).join("");
  el.innerHTML = `<div class="politicas-content">${html}</div>`;
}

// ============================================
// RENDER: PORTFOLIO
// Screenshots flotando + switch a grid
// ============================================

function renderPortfolio(data) {
  const el = document.querySelector(".celda.portfolio");
  if (!el || !data?.portfolio) return;

  const proyectos = data.portfolio.proyectos;

  el.innerHTML = `
    <div class="portfolio-clouds-container" id="portfolio-clouds"></div>
    <div class="portfolio-grid-container" id="portfolio-grid">
      <div class="portfolio-grid">${
        proyectos.map(p => `
          <a class="portfolio-item" href="${p.url}" target="_blank" rel="noopener" title="${p.nombre}">
            <img src="${p.imagen}" alt="${p.nombre}" loading="lazy">
          </a>
        `).join("")
      }</div>
    </div>
    <button class="portfolio-switch" id="portfolio-switch-btn">ordenar</button>
  `;

  generarScreenshotsFlotando(proyectos);
  document.getElementById("portfolio-switch-btn").addEventListener("click", togglePortfolioMode);

  if (portfolioMode === "grid") {
    document.getElementById("portfolio-grid").classList.add("visible");
    document.getElementById("portfolio-clouds").style.opacity = "0";
    document.getElementById("portfolio-switch-btn").textContent = "dispersar";
  }
}

// ============================================
// PORTFOLIO: screenshots flotando
// ============================================

// 6 velocidades distintas de viento — las nubes rápidas son más pequeñas
// Las animaciones css sólo hacen la deriva vertical leve + rotación mínima.
// El movimiento horizontal lo hacemos con una animación de translateX que va
// de -imageWidth a 100vw+imageWidth, lineal, infinita.

function generarScreenshotsFlotando(proyectos) {
  const container = document.getElementById("portfolio-clouds");
  if (!container) return;
  container.innerHTML = "";

  const vw = window.innerWidth;
  const vh = window.innerHeight;
  const isMobile = vw <= 600;

  // Sin duplicados — cada proyecto aparece una sola vez
  const items = proyectos;

  // Distribuimos verticalmente en bandas para que se vean todas
  const numBandas = isMobile ? 4 : 5;
  const bandaH = (vh * 0.82) / numBandas;

  items.forEach((p, i) => {
    const banda = i % numBandas;
    // Y fijo dentro de su banda, con offset aleatorio
    const yBase = vh * 0.06 + banda * bandaH;
    const yOff = (Math.random() - 0.5) * bandaH * 0.5;
    const y = Math.round(yBase + yOff);

    const minW = isMobile ? 80 : 120;
    const maxW = isMobile ? 150 : 220;
    const w = Math.round(minW + Math.random() * (maxW - minW));
    const h = Math.round(w * 0.68);

    // Velocidad del viento: pixels por segundo, nubes más pequeñas van más rápido
    const speedFactor = 1 - (w - minW) / (maxW - minW); // 0 (grande) → 1 (pequeña)
    const pxPerSec = 20 + speedFactor * 30 + Math.random() * 15; // 20–65 px/s
    // Recorrido total: de -w a vw+w = vw + 2*w
    const recorrido = vw + 2 * w;
    const duration = recorrido / pxPerSec;

    // Delay negativo: la nube ya lleva tiempo en marcha al cargar la página
    // Distribuimos delays para que no arranquen todas desde el borde izquierdo
    const delay = -(Math.random() * duration);

    // Deriva vertical y rotación mínima — 6 variantes
    const driftAnims = ["pcloud1","pcloud2","pcloud3","pcloud4","pcloud5","pcloud6"];
    const driftAnim = driftAnims[i % driftAnims.length];
    const driftDur = 8 + Math.random() * 10; // lento, suave

    const a = document.createElement("a");
    a.classList.add("portfolio-cloud-item");
    a.href = p.url;
    a.target = "_blank";
    a.rel = "noopener";
    a.title = p.nombre;

    // Posición inicial: fuera del borde izquierdo
    // El delay negativo hace que "ya haya recorrido" esa distancia
    a.style.left = `${-w}px`;
    a.style.top = `${y}px`;
    a.style.width = `${w}px`;
    a.style.height = `${h}px`;
    a.style.zIndex = 1 + Math.floor(Math.random() * 4);

    // Animación horizontal: translateX de 0 a recorrido, lineal, infinita
    // Usamos una keyframe inline vía CSS custom property no — usamos Web Animations API
    a.animate(
      [
        { transform: "translateX(0px)" },
        { transform: `translateX(${recorrido}px)` }
      ],
      {
        duration: duration * 1000,
        delay: delay * 1000,
        iterations: Infinity,
        easing: "linear",
        fill: "none"
      }
    );

    // Deriva vertical + rotación leve encima (CSS animation separada)
    a.style.animationName = driftAnim;
    a.style.animationDuration = `${driftDur}s`;
    a.style.animationDelay = `${-(Math.random() * driftDur)}s`;
    a.style.animationTimingFunction = "ease-in-out";
    a.style.animationIterationCount = "infinite";
    a.style.animationDirection = "alternate";

    const img = document.createElement("img");
    img.src = p.imagen;
    img.alt = p.nombre;
    img.loading = "lazy";
    a.appendChild(img);

    const name = document.createElement("span");
    name.classList.add("pcloud-name");
    name.textContent = p.nombre;
    a.appendChild(name);

    container.appendChild(a);
  });
}

function togglePortfolioMode() {
  if (portfolioAnimating) return;
  portfolioAnimating = true;

  const cloudsEl = document.getElementById("portfolio-clouds");
  const gridEl = document.getElementById("portfolio-grid");
  const btn = document.getElementById("portfolio-switch-btn");

  if (portfolioMode === "clouds") {
    portfolioMode = "grid";
    cloudsEl.style.transition = "opacity 0.4s ease";
    cloudsEl.style.opacity = "0";
    cloudsEl.style.pointerEvents = "none";
    setTimeout(() => {
      gridEl.classList.add("visible");
      if (btn) btn.textContent = "dispersar";
      portfolioAnimating = false;
    }, 400);
  } else {
    portfolioMode = "clouds";
    gridEl.classList.remove("visible");
    cloudsEl.style.transition = "opacity 0.5s ease";
    cloudsEl.style.opacity = "1";
    cloudsEl.style.pointerEvents = "auto";
    if (btn) btn.textContent = "ordenar";
    setTimeout(() => { portfolioAnimating = false; }, 500);
  }
}

// ============================================
// RENDER ALL
// ============================================

async function renderizarContenido() {
  await loadData();
  const data = getData();
  if (!data) return;

  renderWelcome(data);
  renderStatement(data);
  renderMetodologia(data);
  renderPricing(data);
  renderPoliticas(data);
  renderPortfolio(data);
}

// ============================================
// HEADER
// ============================================

let overlayEl = null;
let zoneLabelEl = null;
let minimapInlineEl = null;
let minimapExpandedEl = null;
let resizeTimeoutId = null;

function getNombrePagina() {
  return nombresEspeciales[`${posY}_${posX}`] || "";
}

function crearZoneLabel() {
  zoneLabelEl = document.createElement("div");
  zoneLabelEl.classList.add("zone-label-bg");
  document.body.appendChild(zoneLabelEl);
}

function actualizarZoneLabel() {
  if (!zoneLabelEl) return;
  zoneLabelEl.textContent = getNombrePagina();
}

function getViewportAspect() {
  return window.innerHeight > 0 ? window.innerWidth / window.innerHeight : 1;
}

function actualizarTamanoMinimapInline() {
  if (!minimapInlineEl) return;
  const base = 14;
  const cellW = Math.max(8, Math.round(base * getViewportAspect()));
  const cellH = base;

  minimapInlineEl.querySelectorAll(".minimap-inline-cell").forEach(cell => {
    cell.style.width = `${cellW}px`;
    cell.style.height = `${cellH}px`;
  });
}

function actualizarTamanoMinimapExpandido() {
  if (!minimapExpandedEl) return;
  const base = Math.min(window.innerWidth * 0.12, 120);
  const cellW = Math.max(40, Math.round(base));
  const cellH = Math.max(24, Math.round(base / getViewportAspect()));

  minimapExpandedEl.querySelectorAll(".minimap-expanded-cell").forEach(cell => {
    cell.style.width = `${cellW}px`;
    cell.style.height = `${cellH}px`;
  });
}

function onViewportResize() {
  actualizarTamanoMinimapInline();
  actualizarTamanoMinimapExpandido();

  const proyectos = getData()?.portfolio?.proyectos;
  if (!proyectos || !document.getElementById("portfolio-clouds")) return;

  generarScreenshotsFlotando(proyectos);
  if (portfolioMode === "grid") {
    const cloudsEl = document.getElementById("portfolio-clouds");
    if (cloudsEl) {
      cloudsEl.style.opacity = "0";
      cloudsEl.style.pointerEvents = "none";
    }
  }
}

function crearHeader() {
  const headerEl = document.createElement("div");
  headerEl.classList.add("header-topright");

  minimapInlineEl = document.createElement("div");
  minimapInlineEl.classList.add("minimap-inline");
  minimapInlineEl.style.gridTemplateColumns = `repeat(${grid[0].length}, 1fr)`;
  minimapInlineEl.style.gridTemplateRows = `repeat(${grid.length}, 1fr)`;

  for (let y = 0; y < grid.length; y++) {
    for (let x = 0; x < grid[y].length; x++) {
      const cell = document.createElement("div");
      cell.classList.add("minimap-inline-cell");
      cell.dataset.y = y;
      cell.dataset.x = x;

      if (grid[y][x] === 0) {
        cell.classList.add("invisible");
      }

      minimapInlineEl.appendChild(cell);
    }
  }

  actualizarTamanoMinimapInline();

  minimapInlineEl.addEventListener("click", () => abrirMinimapExpandido());
  headerEl.appendChild(minimapInlineEl);
  document.body.appendChild(headerEl);
  actualizarHeader();
}

function actualizarHeader() {
  if (!minimapInlineEl) return;
  minimapInlineEl.querySelectorAll(".minimap-inline-cell").forEach(cell => {
    cell.classList.toggle("activa", +cell.dataset.y === posY && +cell.dataset.x === posX);
  });
}

// ============================================
// MINIMAP OVERLAY
// ============================================

function crearOverlay() {
  overlayEl = document.createElement("div");
  overlayEl.classList.add("minimap-overlay");

  minimapExpandedEl = document.createElement("div");
  minimapExpandedEl.classList.add("minimap-expanded");
  minimapExpandedEl.style.gridTemplateColumns = `repeat(${grid[0].length}, 1fr)`;
  minimapExpandedEl.style.gridTemplateRows = `repeat(${grid.length}, 1fr)`;

  for (let y = 0; y < grid.length; y++) {
    for (let x = 0; x < grid[y].length; x++) {
      const cell = document.createElement("button");
      cell.classList.add("minimap-expanded-cell");
      cell.dataset.y = y;
      cell.dataset.x = x;

      if (grid[y][x] === 0) {
        cell.classList.add("invisible");
      } else {
        cell.textContent = nombresEspeciales[`${y}_${x}`] || "";
        cell.addEventListener("click", () => {
          posY = y;
          posX = x;
          actualizarVista();
          actualizarMinimapExpandido();
          setTimeout(() => cerrarMinimapExpandido(), 650);
        });
      }

      minimapExpandedEl.appendChild(cell);
    }
  }

  actualizarTamanoMinimapExpandido();

  overlayEl.appendChild(minimapExpandedEl);
  overlayEl.addEventListener("click", e => {
    if (e.target === overlayEl) cerrarMinimapExpandido();
  });

  document.body.appendChild(overlayEl);
}

function abrirMinimapExpandido() {
  actualizarMinimapExpandido();
  overlayEl.classList.add("visible");
}

function cerrarMinimapExpandido() {
  overlayEl.classList.remove("visible");
}

function actualizarMinimapExpandido() {
  if (!overlayEl) return;
  overlayEl.querySelectorAll(".minimap-expanded-cell").forEach(cell => {
    cell.classList.toggle("activa", +cell.dataset.y === posY && +cell.dataset.x === posX);
  });
}

// ============================================
// NAVIGATION LABELS
// ============================================

function getVecinos() {
  const vecinos = {};
  [
    { dy: -1, dx: 0, pos: "top" },
    { dy: 1,  dx: 0, pos: "bottom" },
    { dy: 0, dx: -1, pos: "left" },
    { dy: 0,  dx: 1, pos: "right" },
  ].forEach(({ dy, dx, pos }) => {
    const ny = posY + dy, nx = posX + dx;
    if (grid[ny]?.[nx] === 1) {
      vecinos[pos] = { y: ny, x: nx, nombre: nombresEspeciales[`${ny}_${nx}`] || "" };
    }
  });
  return vecinos;
}

function crearNavLabels(celda) {
  celda.querySelectorAll(".nav-label").forEach(l => l.remove());
  Object.entries(getVecinos()).forEach(([pos, info]) => {
    const label = document.createElement("button");
    label.classList.add("nav-label", pos);
    label.textContent = info.nombre;
    label.addEventListener("click", () => {
      posY = info.y;
      posX = info.x;
      actualizarVista();
    });
    celda.appendChild(label);
  });
}

// ============================================
// VIEW UPDATE
// ============================================

function actualizarVista() {
  document.querySelectorAll(".celda").forEach(c => c.classList.remove("activa"));
  const activa = document.querySelector(`.pos_${posY}_${posX}`);
  if (activa) {
    activa.classList.add("activa");
    crearNavLabels(activa);
  }
  actualizarHeader();
  actualizarZoneLabel();
  actualizarMinimapExpandido();
}

// ============================================
// KEYBOARD NAVIGATION
// ============================================

document.addEventListener("keydown", e => {
  if (e.key === "Escape" && overlayEl?.classList.contains("visible")) {
    cerrarMinimapExpandido();
    return;
  }

  let newY = posY, newX = posX;
  switch (e.key) {
    case "ArrowUp":    newY--; break;
    case "ArrowDown":  newY++; break;
    case "ArrowLeft":  newX--; break;
    case "ArrowRight": newX++; break;
    default: return;
  }

  if (grid[newY]?.[newX] === 1) {
    posY = newY;
    posX = newX;
    actualizarVista();
  }
});

function scheduleViewportResize() {
  if (resizeTimeoutId) clearTimeout(resizeTimeoutId);
  resizeTimeoutId = setTimeout(onViewportResize, 120);
}

window.addEventListener("resize", scheduleViewportResize);

window.addEventListener("orientationchange", scheduleViewportResize);

// ============================================
// INIT
// ============================================

crearPantallas();
crearZoneLabel();
crearHeader();
crearOverlay();
renderizarContenido().then(() => actualizarVista());
  </script>
</body>
</html>
